---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
WD <- getwd();
DATA_DIR <- "data"
file_path <- file.path(WD, DATA_DIR, "covid19-sp-BR.csv");
cov_data <- read.csv(file_path, header = TRUE, sep = ";");
```

```{r}
# Time step in days
W <- 5;
# Number of rows in the data set
N <- nrow(coviso_data)
# Number of time steps (windows)
NW <- floor(N/W);
# Vectors to store the number of cases and average 
# of isolation levels at each time step
cases_dt <- vector("numeric", NW)
lvels_dt <- vector("numeric", NW)
for (i in 1:NW) {
  k <- i*W
  # Assign the sum the cases from rows [1,k] to ith time step
  cases_dt[i] = sum(cov_data[1:k, 2])
  # Assign the sum the cases from rows [j,k] to ith time step
  j = (i-1)*W + 1
  lvels_dt[i] = mean(cov_data[j:k, 2])
}
```

# Fitting

Logistic function in the exponential form:

    $$ð‘“(t)= {k \over 1 + ({ (k-n_m) \over n_m }) e^{âˆ’rt}}$$

where:
t is a list of values representing the time steps;
n_m is the sigmoid's midpoint;
K is the the maximum value for n;
r is the the logistic growth rate.


```{r}
library(minpack.lm)
temp <- data.frame(y = caws, x = seq(length(caws)))
plot(temp$x, temp$y)
logistic.model <- nlsLM(y ~ (k / (1 + ((k-m)/m)*exp(- r * x))), data = temp, start = list(k = 1, m=1, r = 0.1))
ys_model <- predict(logistic.model, list(x = temp$x))
lines(temp$x, ys_model)
summary(logistic.model)
cor.test(temp$y, ys_model, method=c("pearson"))

```
# Estimating

```{r}
r <-  coef(logistic.model)["r"]
alph <- r * mean(lvels_dt)
K <- coef(logistic.model)["k"]
M <- coef(logistic.model)["m"]
ys_estimated <- vector("numeric", NW)
for (i in 1:NW) {
  ys_estimated[i] <- K / (1 + ((K-M)/M)*exp(- r * i))
}
plot(temp$x, ys_estimated)
points(temp$x, cases_dt)
cor.test(cases_dt, ys_estimated, method=c("pearson"))
```
